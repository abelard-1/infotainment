<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staffanstorp Glass-Dashboard Pro</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Glas-effekt inställningar */
            --glass-bg: rgba(20, 20, 20, 0.6); /* Mer transparent för glaskänsla */
            --glass-border: rgba(255, 255, 255, 0.12);
            --accent: #5e92f3;
            --text-main: #ffffff;
            --text-dim: #bbb;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            background-size: cover;
            background-position: center;
            margin: 0; height: 100vh; width: 100vw; color: var(--text-main);
            display: grid; 
            grid-template-columns: 1.1fr 0.9fr; 
            grid-template-rows: 100px 1fr 100px; 
            gap: 25px; padding: 25px; box-sizing: border-box; overflow: hidden;
            transition: background-image 2s ease-in-out;
        }

        /* Overlay för att göra texten läsbar mot bakgrunden */
        body::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4); z-index: -2;
        }

        /* Glaseffekt för alla paneler */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(25px) saturate(160%); /* Frostat glas-effekt */
            -webkit-backdrop-filter: blur(25px) saturate(160%);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
        }

        /* TOP BAR */
        .top-bar { 
            grid-column: 1/3; 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 40px;
        }
        #mini-clock { font-size: 4.2rem; font-weight: 800; letter-spacing: -2px; }
        #mini-date { font-size: 1.8rem; color: var(--accent); font-weight: 300; text-transform: capitalize; }
        
        /* Citaten i mitten av top-baren */
        #top-quote {
            flex-grow: 1;
            text-align: center;
            padding: 0 30px;
            font-style: italic;
            font-size: 1.1rem;
            color: #eee;
            font-weight: 300;
            max-width: 500px;
            line-height: 1.3;
        }

        .panel { padding: 35px; display: flex; flex-direction: column; height: 100%; box-sizing: border-box; }
        .panel-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; opacity: 0.6; }
        .panel-header h2 { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 4px; margin: 0; }

        /* KALENDER */
        .event-item { display: flex; align-items: center; gap: 30px; padding: 18px 0; border-bottom: 1px solid rgba(255,255,255,0.06); }
        .event-time-block { min-width: 200px; }
        .event-day { font-size: 1.3rem; color: var(--accent); font-weight: 800; text-transform: uppercase; }
        .event-time { font-size: 3.2rem; font-weight: 800; line-height: 1; margin-top: 4px; }
        .event-title { font-size: 1.7rem; color: #fff; font-weight: 400; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* VÄDER */
        .sun-row { display: flex; gap: 35px; margin-bottom: 25px; font-size: 1.4rem; font-weight: 300; }
        #hourly-forecast { 
            display: flex; justify-content: space-between; margin-bottom: 30px; 
            padding: 20px; background: rgba(255,255,255,0.05); border-radius: 25px; 
        }
        .hour-item { text-align: center; }
        .hour-temp { font-size: 1.8rem; font-weight: 700; margin-top: 5px; }

        .weather-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; }
        .weather-day { font-size: 1.7rem; width: 140px; text-transform: capitalize; }
        .weather-temp { font-size: 2rem; font-weight: 800; width: 110px; text-align: right; }

        /* HISTORIK */
        #history-mini { margin-top: auto; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 20px; }
        #history-text { font-size: 1.1rem; color: #ddd; line-height: 1.4; font-weight: 300; }

        /* NYHETER */
        #news-card { grid-column: 1/3; display: flex; align-items: center; padding: 0 35px; overflow: hidden; position: relative; }
        #news-content { font-size: 1.8rem; font-weight: 300; }
        #news-progress { position: absolute; bottom: 0; left: 0; height: 4px; background: var(--accent); width: 0%; transition: width 10s linear; }

        @keyframes fall { to { transform: translateY(110vh) translateX(30px); } }
        .snow-flake { position: fixed; top: -20px; color: white; pointer-events: none; z-index: 100; opacity: 0.8; }
    </style>
</head>
<body>

<header class="top-bar glass-panel" style="border-radius: 25px;">
    <div id="mini-date">Laddar...</div>
    <div id="top-quote">"Det enda vi vet är att vi ingenting vet."</div>
    <div id="mini-clock">00:00</div>
</header>

<section class="panel glass-panel">
    <div class="panel-header"><i data-lucide="calendar" style="width:16px"></i><h2>SCHEMA</h2></div>
    <div id="custom-calendar-list"></div>
</section>

<section class="panel glass-panel">
    <div class="panel-header"><i data-lucide="cloud-sun" style="width:16px"></i><h2>VÄDER & HISTORIA</h2></div>
    
    <div class="sun-row">
        <span><i data-lucide="sunrise" style="color:#ffcd00; width:22px; vertical-align:middle;"></i> <span id="sunrise-val">--:--</span></span>
        <span><i data-lucide="sunset" style="color:#ff9d00; width:22px; vertical-align:middle;"></i> <span id="sunset-val">--:--</span></span>
    </div>

    <div id="hourly-forecast"></div>
    <div id="daily-list"></div>

    <div id="history-mini">
        <div style="color:var(--accent); font-size:0.75rem; text-transform:uppercase; letter-spacing:2px; margin-bottom:8px;">Idag i historien</div>
        <div id="history-text">Hämtar historisk händelse...</div>
    </div>
</section>

<footer id="news-card" class="glass-panel" style="border-radius: 25px;">
    <div id="news-content"></div>
    <div id="news-progress"></div>
</footer>

<script>
    const API_KEY = 'AIzaSyAC3QiGhqOM2F2ZrnFq3xWUu6_1bAwOvSw';
    const CAL_ID = 'rezgarhayder@gmail.com';

    function updateClock() {
        const now = new Date();
        document.getElementById('mini-clock').innerText = now.toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'});
        document.getElementById('mini-date').innerText = now.toLocaleDateString('sv-SE', {weekday:'long', day:'numeric', month:'long'});
    }

    const quotes = [
        "Det vi gör i livet, ekar i evigheten.",
        "Lycka är inte något färdiglagat. Den kommer från dina egna handlingar.",
        "Människan lider mer i fantasin än i verkligheten.",
        "Den som har ett 'varför' att leva för kan uthärda nästan vilket 'hur' som helst.",
        "Allt som irriterar oss hos andra kan leda oss till en förståelse av oss själva.",
        "Du har makt över ditt sinne – inte externa händelser. Inse detta, och du kommer att finna styrka.",
        "Problemet är inte att vi har lite tid, utan att vi slösar bort mycket av den."
    ];

    function updateQuote() {
        const quoteEl = document.getElementById('top-quote');
        quoteEl.innerText = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;
    }

    async function updateCalendar() {
        try {
            const now = new Date();
            const nextWeek = new Date();
            nextWeek.setDate(now.getDate() + 7);
            const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CAL_ID)}/events?key=${API_KEY}&timeMin=${now.toISOString()}&timeMax=${nextWeek.toISOString()}&singleEvents=true&orderBy=startTime`;
            const res = await fetch(url);
            const data = await res.json();
            if (data.items) {
                document.getElementById('custom-calendar-list').innerHTML = data.items.slice(0, 6).map(event => {
                    const d = new Date(event.start.dateTime || event.start.date);
                    return `
                        <div class="event-item">
                            <div class="event-time-block">
                                <div class="event-day">${d.toLocaleDateString('sv-SE', {weekday:'short', day:'numeric'})}</div>
                                <div class="event-time">${event.start.dateTime ? d.toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'}) : 'HELDAG'}</div>
                            </div>
                            <div class="event-title">${event.summary}</div>
                        </div>`;
                }).join('');
            }
        } catch (e) {}
    }

    async function updateWeather() {
        try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=55.64&longitude=13.21&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset&hourly=temperature_2m,weathercode&timezone=auto');
            const data = await res.json();
            const currH = new Date().getHours();
            const code = data.hourly.weathercode[currH];

            // Bakgrundsbild baserat på väder
            let bg = "https://images.unsplash.com/photo-1470770841072-f978cf4d019e?q=80&w=1920"; 
            if(code <= 3) bg = "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=1920"; // Berg/Klart
            if(code >= 51) bg = "https://images.unsplash.com/photo-1428592953211-077101b2021b?q=80&w=1920"; // Regn/Dimma
            if(code >= 71) bg = "https://images.unsplash.com/photo-1483664852095-d6cc6870702d?q=80&w=1920"; // Vinter/Snö
            document.body.style.backgroundImage = `url('${bg}')`;

            // Snöanimation
            document.querySelectorAll('.snow-flake').forEach(f => f.remove());
            if (code >= 71 && code <= 77) {
                for (let i = 0; i < 40; i++) {
                    let f = document.createElement('div'); f.className = 'snow-flake'; f.innerHTML = '•';
                    f.style.left = Math.random() * 100 + 'vw';
                    f.style.animation = `fall ${Math.random() * 5 + 5}s linear infinite`;
                    document.body.appendChild(f);
                }
            }

            document.getElementById('sunrise-val').innerText = new Date(data.daily.sunrise[0]).toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('sunset-val').innerText = new Date(data.daily.sunset[0]).toLocaleTimeString('sv-SE', {hour:'2-digit', minute:'2-digit'});

            let hHtml = '';
            for(let i=currH; i<currH+6; i++) {
                hHtml += `<div class="hour-item"><div class="hour-time">${i%24}:00</div><i data-lucide="${getWeatherIcon(data.hourly.weathercode[i])}" style="width:24px; color:var(--accent)"></i><div class="hour-temp">${Math.round(data.hourly.temperature_2m[i])}°</div></div>`;
            }
            document.getElementById('hourly-forecast').innerHTML = hHtml;

            let dHtml = '';
            for(let i=0; i<5; i++) {
                const d = new Date(data.daily.time[i]).toLocaleDateString('sv-SE', {weekday:'short'});
                dHtml += `<div class="weather-row"><span class="weather-day">${i===0?'Idag':d}</span><i data-lucide="${getWeatherIcon(data.daily.weathercode[i])}" style="width:32px"></i><span class="weather-temp">${Math.round(data.daily.temperature_2m_max[i])}°</span></div>`;
            }
            document.getElementById('daily-list').innerHTML = dHtml;
            lucide.createIcons();
        } catch(e) {}
    }

    function getWeatherIcon(code) {
        if (code <= 3) return 'sun';
        if (code >= 71 && code <= 77) return 'snowflake';
        if (code >= 51) return 'cloud-rain';
        return 'cloud';
    }

    async function updateHistory() {
        try {
            const today = new Date();
            const res = await fetch(`https://en.wikipedia.org/api/rest_v1/feed/onthisday/events/${today.getMonth()+1}/${today.getDate()}`);
            const data = await res.json();
            const event = data.events[Math.floor(Math.random() * Math.min(data.events.length, 20))];
            document.getElementById('history-text').innerHTML = `<b>${event.year}:</b> ${event.text}`;
        } catch(e) {}
    }

    let news = []; let idx = 0;
    async function getNews() {
        try {
            const r = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://www.svt.se/nyheter/rss.xml');
            const d = await r.json(); news = d.items; rotate();
        } catch(e) {}
    }
    function rotate() {
        const c = document.getElementById('news-content'); const p = document.getElementById('news-progress');
        if(news[idx]) c.innerText = news[idx].title;
        p.style.transition = 'none'; p.style.width = '0%';
        p.offsetHeight; p.style.transition = 'width 10000ms linear'; p.style.width = '100%';
        idx = (idx + 1) % news.length;
        setTimeout(rotate, 10000);
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateClock(); setInterval(updateClock, 1000);
        updateWeather(); setInterval(updateWeather, 600000);
        updateCalendar(); setInterval(updateCalendar, 600000);
        updateHistory(); setInterval(updateHistory, 3600000);
        updateQuote(); setInterval(updateQuote, 21600000); // Byt citat var 6:e timme
        getNews();
    });
</script>
</body>
</html>
